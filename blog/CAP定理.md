## 目录
1. [CAP定理](#1-cap定理)
2. [可用性](#2-可用性availability)
3. [分区容忍性](#3-分区容忍性partition-tolerance)  
  3.1 [分区](#31-分区)  
  3.2 [分布式系统为什么不能同时选择CA](#32-分布式系统为什么不能同时选择ca)  
4. [一致性](#4-一致性consistency)  
  4.1 [ACID](#41-acid)  
  4.2 [为什么不一致](#42-为什么不一致)  
5. [BASE理论](#5-base理论)

## 1. CAP定理
一个分布式系统不可能同事满足一致性(Consistency),可用性(Availability)和分区容忍性(Partition tolerance),最多只能同时满足两个

>**一致性**：数据在多个副本之间保持一致。这很好理解,你在同一时间从集群的任意一个节点进行读写操作,结果都应该一样
>
>**可用性**：每一个请求都应该在一定时间内获得明确响应。你不应该让请求方一直等下去，也不应该报错
>
>**分区容忍性**：节点之间有消息丢失，系统仍然能继续运行。当系统中某两个节点间不能正常通信的时候，不能让系统挂掉

## 2. 可用性（Availability）
  &emsp;&emsp;可用性有两个指标
>1. **明确响应**：所有可能的响应结果都应该在契约中有明确定义，不应该出现协议之外的响应或异常
>2. **一定时间**：所有的请求都应该在一定时间内返回，不能让请求方一直等待

  &emsp;&emsp;对于一个本地调用来说，请求结果通常只有两种状态：成功和失败。但是引入了网络之后，除了成功和失败之外，还会产生超时，这时候是无法确定请求到底是成功还是失败的。

## 3. 分区容忍性（Partition tolerance）
#### 3.1 分区
&emsp;&emsp;首先分区如何产生？因为网络、硬件或软件的原因，导致两个节点之间的消息不能正常投递。那么不能被正常访问到的节点和其它节点就形成了不同的分区
#### 3.2 分布式系统为什么不能同时选择CA
&emsp;&emsp;基于网络的不可靠性，分区必然是会发生的。**当分区发生的时候，你或者失去一致性（因为允许分别更新分区两边）或者失去可用性（因为你检测到错误，关闭系统，直到分区消失）**

## 4. 一致性（Consistency）

#### 4.1 ACID
&emsp;&emsp;一致性要求我们在**同一时间在系统任何一个节点进行的读写操作都能得到一致的结果**。关系型数据库通常会谈到ACID特性，满足ACID特性的数据库都通过**事务机制**来达到一致性
>* A: Atomicity，原子性 
>* C : Consistency， 一 致性
>* I: Isolation，隔离性。
>* D: Durability，持久性。

#### 4.2 为什么不一致
  &emsp;&emsp;分布式系统为了解决大数据、高并发、复杂业务逻辑的问题，会对服务进行水平扩展或垂直拆分
>* **水平扩展**：将一个节点扩展为多个节点，那么这些节点之间的数据就可能会产生不一致
>* **垂直拆分**：将一个业务拆分成多个职责单一的模块进行合作，那么这些模块之间的数据和状态也就有可能产生不一致

&emsp;&emsp;我们仍然可以通过**分布式事务**来尽量保证一致性，但那将会付出更大的代价

## 5. BASE理论
  &emsp;&emsp;在[分区容忍性](#3-分区容忍性partition-tolerance)这一节已经分析过了，分区是不可避免的，所以我们需要在C和A之间进行取舍，当然这种取舍也并不是非此即彼的，我们可以在这两者之间找到一个平衡

##### **BASE理论**
>* BA: Basically Available，基本可用 。基本可用是指在出现故障时，可以损失一部分非核心流程的可用性来保证系统基本可用
>* S: Soft State，软状态。允许状态在一段时间内不同步。
>* E: Eventually Consistent，**最终一致**。你不能让系统永远处于软状态，所以在一定的时间窗口内， 最终数据达成一致即可。

&emsp;&emsp;BASE理论是在CAP定理下在**一致性**和**可用性**之间进行博弈的结果。不要求**强一致性**，而是根据自身的业务特点，采用适当的方式来使系统达到最终一致性

TEST

## 参考
* 《分布式服务架构：原理、设计与实战》一书作者李艳鹏、杨彪，电子工业出版社2017年8月出版》
* [CAP迷思：关于分区容忍性](http://zzyongx.github.io/blogs/cap-confusion-problems-with-partition-tolerance.html)




